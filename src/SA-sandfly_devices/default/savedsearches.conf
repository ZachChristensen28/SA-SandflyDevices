# DO NOT EDIT THIS FILE!
# Please make all changes to files in ../local.
# To make changes, copy the section/stanza you want to change from ./default
# into ../local and edit there.

[Sandfly Devices Lookup - Gen]
cron_schedule = 3-33/30 * * * *
description = populates kvstore lookup: sandfly_devices
dispatch.earliest_time = -61m@m
dispatch.latest_time = -1m@m
enableSched = 0
schedule_window = auto
search = index=sandfly sourcetype="sandfly:devices:summary" \
| dedup host_id \
| rename last_seen_ip_addr as ip, os_info_node as dns\
| eval \
    nt_host=mvindex(split(dns, "."),0),\
    firstSeen=if(isnull(firstSeen), now(), firstSeen),\
    _key=md5(dns),\
    lastSeen=now(),\
    category="gen: sandfly", \
    category=mvappend(category,"active: ".active),\
    category=mvappend(category,"auth_status: ".authentication_status),\
    category=mvappend(category, "firstSeen: ".date_first_seen),\
    category=mvappend(category, "lastSeen: ".date_last_seen),\
    category=mvappend(category, "firstIP: ".first_seen_ip_addr),\
    category=mvappend(category, "os: ".os_info_os_release_name),\
    category=mvappend(category, "osVersion: ".os_info_os_release_version),\
    category=mvappend(category, "kernel: ".os_info_release),\
    category=mvappend(category, "uptimeDays: ".os_info_uptime_days),\
    category=if(isnotnull('os_hardware_cpu_bugs{}'), mvappend(category, "osBugs: ".mvjoin('os_hardware_cpu_bugs{}', ", ")), category),\
    category=mvjoin(category,"|")\
| table _key,ip,nt_host,dns,category,firstSeen,lastSeen\
| outputlookup key_field=_key sandfly_devices
